数仓体系结构4个层次：数据源，数据存储和管理，数据服务，数据应用


hive建立在hadoop上的数据仓库,facebook开发，本身不存储和处理数据，依赖于HDFS存储数据，依赖MR处理数据
hive把hql语句转换成MR任务,采用批处理的方式对海量数据进行处理.
hive提供了一系列对数据进行提取，转换，加载的工具，可以存储，查询分析存储在hdfs上的数据

hbase是面向列的，分布式可伸缩的数据库,可提供数据的实时访问功能，实时访问功能正是hadoop所欠缺的
hive只能处理静态数据，主要是BI报表数据，hive初衷为了减少复杂MR应用程序的编写工作

hive和pig用于报表中心，hive用于分析报表，pig用于报表中数据的转换工作
mahout提供一些可扩展的机器学习领域的经典算法实现，用于创建商务智能(BI)应用程序

hive主要由用户接口模块，驱动模块，元数据存储模块
用户接口模块：
	cli是hive自带的命令行界面
	hwi是hive的一个简单网页界面
	jdbc和odbc以及Thrift Server可向用户提供进行编程的接口,其中Thrift Server是基于Thrift软件框架开发，提供hive的rpc通信接口

驱动模块(driver)：含编译器，优化器，执行器等，负责把HQL语句转换成MR作业，所有命令和查询都会进入驱动模块，通过该模块的解析编译，对计算过程进行优化，然后按照制定的步骤执行
元数据存储模块（metastore）：是一个独立的关系型数据库，通常与mysql数据库连接后创建的一个mysql实例，也可以是hive自带的DerBy数据库实例.主要保存表模式和其他系统元数据，如表名称，表的列及其属性，表的分区及其属性等


hive中sql查询转换成MR作业的过程:
hive收到hql语句后，首先进入驱动模块，由驱动模块编译器解析变异，然后由优化器对该操作进行优化计算，最后交由执行器执行，执行器通常启动一个或多个MR任务，有时也不启动，比如全表扫描

由于hive实际应用中，会暴露出不稳定，极少数情况会出现端口不响应或进程丢失的问题，因此需要hive ha去进行解决
在HA中，hadoop数仓由多个hive实例进行管理，这些hive实例被纳入到一个资源池中，由HAProxy提供统一的对外接口
客户端查询请求首先访问HAProxy，HAProxy对访问请求进行转发，HAProxy收到请求后，会轮询资源池中可用的Hive实例，执行逻辑可用性测试
如果hive实例不可用，就放入黑名单，并从资源池取出下一个hive实例进行逻辑可用性测试,如果hive实例可用，就把客户端的访问请求转发到hive实例上

对于黑名单的hive，HA会每隔一段时间进行处理，首先尝试重启该hive实例，如果重启成功，就再次把它放入资源池中


impala由Google开发的交互式数据分析系统,支持实时计算，提供与Hive类似的功能，性能高出hive3-30倍
impala采用与商用并行关系数据库类似的分布式查询引擎，可直接从HDFS,HBase中用sql语句查询数据，不需要把sql语句转换成MR任务，降低延迟
impala不能替换hive可提供一个统一的平台用于实时查询,impala运行依赖于hive的元数据存储模块,

impala由impalad,State  Store和cli三部分组成
impalad:
	是impala的一个进程,负责协调客户端提供的查询执行,给其他impalad分配任务，以及收集其他impalad的执行结果进行汇总
cli：
	给用户提供了执行查询的命令行工具
state store:
	收集分布在集群上各个impalad进程的资源信息,用于查询的调度，会创建一个statestored进程,来跟踪集群中的impalad的健康状态及位置信息


impala和hive不同点:
	hive适合长时间批处理查询分析,而impala适合进行交互式sql查询
	hive在执行过程中若内存放不下所有数据，则会使用外村，以保证查询能够顺利执行完成,而impala在遇到内存放不下数据时,不会利用外存,所以impala处理查询时会受到一定的限制

impala比hive快的原因：
	真正的MPP(大规模并行处理)查询引擎
	使用C++开发，而不是java
	运行时代码生成(LLVM IR),提高效率
	全新的执行引擎
	执行sql语句时,impala不会把中间数据写入到磁盘，而是在内存中完成了所有处理
	直接查询数据，不会生产mapreduce任务
	impala为每个查询产生汇编级的代码，当impala在本地内存中运行的时候，这些汇编代码执行效率高于其他代码框架
	impala查询计划解析器使用更智能的算法在多节点上分布式执行各个查询步骤,同时避免了sorting和shuffle两个非常耗时的阶段,
	impala拥有HDFS上面各个data block的信息，当它处理查询的时候能够在各个datanode上面更均衡的分发查询。




ETL工具和BI报表，pig,hbase,mahout，ODBC学习，lmpala